unified_prompt: |

  Your task is to rephrase the user’s query by integrating relevant context from the chat history, strictly preserving key business parameters and phrases unless the user has explicitly changed them. The goal is to produce a clear, structured query that accurately reflects the user's intent and is optimized for SQL generation.

  Steps to follow:

  1. Analyze the chat history: {chat_history}
  2. Review the user query: {user_query}
  3. For each of these Key parameters— {key_parameters} .List only those that are present in chat history or user query . Do not include any parameter that is missing from both sources.
  4. Identify and preserve all key phrases: {keyphrases}, keeping them unchanged.
  5. Integrate relevant context from the chat history into the user query.
  6. Ensure the rephrased query is unambiguous and directly suitable for SQL generation.


  Example Rephrasing:
  Chat History 1:
  - user: "Show sales orders for customer 500"
  rephrased: "Retrieve sales order information from the PONPURE_SALEORDERHDRS table where customer_id equals 500."
  - user: "Only include orders with export transaction type"
  rephrased: "Retrieve sales order information from the PONPURE_SALEORDERHDRS table where customer_id equals 500 and trans_type_name equals 'EXPORT'."
  - user: "Add line item details"
  rephrased: "Retrieve sales order header information from PONPURE_SALEORDERHDRS and line item details from PONPURE_SALEORDERDTLS where customer_id equals 500 and trans_type_name equals 'EXPORT'."
  - user: "Show quotation information too"
  rephrased: "Retrieve sales order header information from PONPURE_SALEORDERHDRS, line item details from PONPURE_SALEORDERDTLS, and originating quotation information from PONPURE_QUOTATIONHDRS where customer_id equals 500 and trans_type_name equals 'EXPORT'."
  
  Chat History 2:
    - user: "Show quotations with status 1"
      rephrased: "Retrieve quotation information from the PONPURE_QUOTATIONHDRS table where status_id equals 1."
    - user: "Filter to only quotations that haven't expired"
      rephrased: "Retrieve quotation information from the PONPURE_QUOTATIONHDRS table where status_id equals 1 and quotation_valid_upto is greater than or equal to current date."
    - user: "Include customer details"
      rephrased: "Retrieve quotation information including customer details from the PONPURE_QUOTATIONHDRS table where status_id equals 1 and quotation_valid_upto is greater than or equal to current date."
    - user: "Show total value of quotations"
      rephrased: "Retrieve quotation information including customer details and total_value from the PONPURE_QUOTATIONHDRS table where status_id equals 1 and quotation_valid_upto is greater than or equal to current date."

  Chat History 3:
    - user: "Show sales order line items for header 1001"
      rephrased: "Retrieve line item details from the PONPURE_SALEORDERDTLS table where header_id equals 1001."
    - user: "Only include items with quantity greater than 100"
      rephrased: "Retrieve line item details from the PONPURE_SALEORDERDTLS table where header_id equals 1001 and quantity is greater than 100."
    - user: "Include total sales price"
      rephrased: "Retrieve line item details including total_sales_price from the PONPURE_SALEORDERDTLS table where header_id equals 1001 and quantity is greater than 100."

  Chat History 4:
    - user: "Show back to back orders"
      rephrased: "Retrieve sales order information from the PONPURE_SALEORDERHDRS table where is_back_to_back_order equals 1."
    - user: "Only include export transactions"
      rephrased: "Retrieve sales order information from the PONPURE_SALEORDERHDRS table where is_back_to_back_order equals 1 and trans_type_name equals 'EXPORT'."
    - user: "Add line item information"
      rephrased: "Retrieve sales order header information from PONPURE_SALEORDERHDRS and line item details from PONPURE_SALEORDERDTLS where is_back_to_back_order equals 1 and trans_type_name equals 'EXPORT'."

  Chat History 5:
    - user: "List the top 10 sales orders by total value from January 1 2024 to March 31 2024"
      rephrased: "Retrieve the top 10 sales orders by total value from the PONPURE_SALEORDERHDRS table joined with PONPURE_SALEORDERDTLS table between January 1 2024 and March 31 2024."
    - user: "Only include export transactions"
      rephrased: "Retrieve the top 10 sales orders by total value from the PONPURE_SALEORDERHDRS table joined with PONPURE_SALEORDERDTLS table between January 1 2024 and March 31 2024 where trans_type_name equals 'EXPORT'."
    - user: "Include customer information"
      rephrased: "Retrieve the top 10 sales orders by total value including customer information from the PONPURE_SALEORDERHDRS table joined with PONPURE_SALEORDERDTLS table between January 1 2024 and March 31 2024 where trans_type_name equals 'EXPORT'."

  Chat History 6:
    - user: "Show pending quotations that haven't converted to sales orders"
      rephrased: "Retrieve pending quotation information from PONPURE_QUOTATIONHDRS that haven't converted to sales orders by joining with PONPURE_SALEORDERHDRS."
    - user: "Only include quotations that are still valid"
      rephrased: "Retrieve pending quotation information from PONPURE_QUOTATIONHDRS that haven't converted to sales orders and are still valid (quotation_valid_upto is greater than or equal to current date)."
    - user: "Include total quoted value"
      rephrased: "Retrieve pending quotation information including total_value from PONPURE_QUOTATIONHDRS that haven't converted to sales orders and are still valid (quotation_valid_upto is greater than or equal to current date)."

  Chat History 7:
    - user: "Show quotation conversion rates by collector"
      rephrased: "Retrieve quotation conversion rates by collector_id from PONPURE_QUOTATIONHDRS joined with PONPURE_SALEORDERHDRS."
    - user: "Only include collectors from specific region"
      rephrased: "Retrieve quotation conversion rates by collector_id from PONPURE_QUOTATIONHDRS joined with PONPURE_SALEORDERHDRS where company_location_id equals 5."
    - user: "Include conversion percentage"
      rephrased: "Retrieve quotation conversion rates including conversion percentage by collector_id from PONPURE_QUOTATIONHDRS joined with PONPURE_SALEORDERHDRS where company_location_id equals 5."

    Chat History 8:
      - user: "Show monthly sales performance for the last 6 months"
        rephrased: "Retrieve monthly sales performance data from PONPURE_SALEORDERHDRS joined with PONPURE_SALEORDERDTLS for the last 6 months."
      - user: "Only include export transactions"
        rephrased: "Retrieve monthly sales performance data from PONPURE_SALEORDERHDRS joined with PONPURE_SALEORDERDTLS for the last 6 months where trans_type_name equals 'EXPORT'."
      - user: "Include item details and revenue"
        rephrased: "Retrieve monthly sales performance data including item details and total revenue from PONPURE_SALEORDERHDRS joined with PONPURE_SALEORDERDTLS for the last 6 months where trans_type_name equals 'EXPORT'."      
      
  Expected JSON Output Format:
    - Return only the JSON object.
    - Do not include any formatting, markdown, triple backticks, or additional explanations.
    - The output must start directly with the curly braces character and end with the curly braces.
    {{
      "rephrased_query" : "<your rephrased query here>"
    }}

